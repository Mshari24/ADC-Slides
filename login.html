<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Log in • Aramco Digital</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body class="login-body">
  <div class="login-shell">
    <section class="login-hero" aria-label="Welcome message">
      <div class="hero-layer" aria-hidden="true"></div>
      <div class="hero-text">
        <h1>Welcome to Aramco Digital Slides</h1>
        <p>Empowering innovation with secure access to your digital workspace and services.</p>
      </div>
    </section>

    <section class="login-side" aria-labelledby="login-heading">
      <div class="login-card">
        <img class="brand-logo" src="./pic/aramco-digital.png" alt="Aramco Digital" />
        <h2 class="login-heading" id="login-heading">USER LOGIN</h2>
        <form id="login-form" class="login-form" novalidate>
          <div class="form-field">
            <label for="email">Email</label>
            <input type="email" id="email" name="email" placeholder="E.g.: Name@company.com" required />
            <p class="error" id="email-error" aria-live="polite"></p>
          </div>
          <div class="form-field password-field">
            <label for="password">Password</label>
            <div class="input-wrapper">
              <input type="password" id="password" name="password" class="with-toggle" placeholder="••••••••" required minlength="6" />
              <button type="button" id="toggle-password" class="toggle-visibility" aria-label="Show password" aria-pressed="false" data-state="hidden">
                <svg class="icon-eye" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.8">
                  <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12Z" />
                  <circle cx="12" cy="12" r="3.5" />
                </svg>
                <svg class="icon-eye-off" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.8">
                  <path d="M3 3l18 18" />
                  <path d="M10.7 5.1A11.6 11.6 0 0 1 12 5c7 0 11 7 11 7a17.6 17.6 0 0 1-4.1 4.8" />
                  <path d="M6.1 6.6A17.7 17.7 0 0 0 1 12s4 7 11 7c1.3 0 2.5-.2 3.6-.6" />
                  <circle cx="12" cy="12" r="3.5" />
                </svg>
              </button>
            </div>
            <p class="error" id="password-error" aria-live="polite"></p>
          </div>
          <label class="remember-option">
            <input type="checkbox" id="remember" name="remember" checked />
            <span>Remember Me</span>
          </label>
          <button type="submit" class="login-button">Log in</button>
          <p class="form-message" id="form-message" aria-live="polite"></p>
        </form>
      </div>
    </section>
  </div>

  <script src="./storage.js"></script>
  <script src="./dark-mode.js"></script>
  <script>
  (function() {
    const storage = window.AccountStorage;
    const form = document.getElementById('login-form');
    const email = document.getElementById('email');
    const password = document.getElementById('password');
    const toggle = document.getElementById('toggle-password');
    const remember = document.getElementById('remember');
    const emailError = document.getElementById('email-error');
    const passwordError = document.getElementById('password-error');
    const formMessage = document.getElementById('form-message');
    const params = new URLSearchParams(window.location.search);

    const resolveRedirect = (target) => {
      if (!target) return './home.html';
      if (/^https?:\/\//i.test(target)) {
        return target;
      }
      let sanitized = target.trim();
      if (sanitized.startsWith('/')) {
        sanitized = sanitized.replace(/^\/+/g, '');
      }
      if (!sanitized.startsWith('./') && !sanitized.startsWith('../')) {
        sanitized = './' + sanitized;
      }
      return sanitized || './home.html';
    };

    if (storage) {
      const existing = storage.getCurrentAccount();
      if (existing) {
        if (existing.preferences && existing.preferences.rememberLogin === false) {
          storage.clearCurrentAccount();
        } else {
          window.location.replace(resolveRedirect(params.get('redirect')));
          return;
        }
      }
    }

    function clearErrors() {
      emailError.textContent = '';
      passwordError.textContent = '';
      formMessage.textContent = '';
      formMessage.className = 'form-message';
    }

    if (toggle && password) {
      toggle.addEventListener('click', function() {
        const hidden = password.type === 'password';
        password.type = hidden ? 'text' : 'password';
        toggle.dataset.state = hidden ? 'visible' : 'hidden';
        toggle.setAttribute('aria-pressed', String(hidden));
        toggle.setAttribute('aria-label', hidden ? 'Hide password' : 'Show password');
      });
    }

    form.addEventListener('submit', function(e) {
      e.preventDefault();
      clearErrors();

      let hasError = false;
      if (!email.value) {
        emailError.textContent = 'Email is required.';
        hasError = true;
      } else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email.value)) {
        emailError.textContent = 'Enter a valid email address.';
        hasError = true;
      }

      if (!password.value) {
        passwordError.textContent = 'Password is required.';
        hasError = true;
      } else if (password.value.length < 6) {
        passwordError.textContent = 'incorrect password';
        hasError = true;
      }

      if (hasError) return;

      formMessage.textContent = 'Logging in...';
      formMessage.className = 'form-message info';

      setTimeout(function () {
        formMessage.textContent = 'Logged in successfully (demo).';
        formMessage.className = 'form-message success';

        const emailValue = email.value.trim();
        const localPart = emailValue.split('@')[0] || '';
        const nameSegments = localPart.replace(/[\._-]+/g, ' ').trim().split(/\s+/).filter(Boolean);
        const displayName = nameSegments.length
          ? nameSegments.map(part => part.charAt(0).toUpperCase() + part.slice(1)).join(' ')
          : 'User';
        const formattedName = nameSegments.length
          ? nameSegments.map(part => part.charAt(0).toUpperCase() + part.slice(1)).join('-')
          : displayName.replace(/\s+/g, '-') || 'User';
        const initials = nameSegments.length
          ? nameSegments.map(part => part.charAt(0).toUpperCase()).join('').slice(0, 2)
          : (emailValue ? emailValue.slice(0, 2).toUpperCase() : 'AD');

        if (storage) {
          storage.ensureAccount(emailValue, {
            displayName,
            formattedName,
            displayEmail: emailValue,
            initials,
            firstInitial: initials.charAt(0) || displayName.charAt(0).toUpperCase()
          });

          storage.updateAccount(emailValue, (account) => {
            account.profile.displayName = displayName;
            account.profile.formattedName = formattedName;
            account.profile.displayEmail = emailValue;
            account.profile.email = account.profile.email || emailValue.toLowerCase();
            account.profile.initials = initials;
            account.profile.firstInitial = initials.charAt(0) || displayName.charAt(0).toUpperCase();
            account.preferences = account.preferences || {};
            account.preferences.rememberLogin = remember ? remember.checked : true;
          });

          storage.setCurrentAccount(emailValue);
          storage.clearLegacyProfileKeys();
        }

        const redirectTarget = resolveRedirect(params.get('redirect'));
        window.location.href = redirectTarget;
      }, 600);
    });
  })();
  </script>
</body>
</html>


